{"remainingRequest":"/Users/admin/Desktop/luckytruck/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/admin/Desktop/luckytruck/src/components/AccountInfoVehiclesAndTrailers.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/admin/Desktop/luckytruck/src/components/AccountInfoVehiclesAndTrailers.vue","mtime":1563263991686},{"path":"/Users/admin/Desktop/luckytruck/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/admin/Desktop/luckytruck/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/admin/Desktop/luckytruck/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {\n  validateField,\n  validateForm,\n  required,\n   minLength\n} from '../validators.js';\nimport uuidv4 from \"uuid/v4\";\nimport { API } from \"../api.js\";\nimport ModalLogin from \"./ModalLogin.vue\";\nimport {mapState} from \"vuex\"\nexport default {\n  name: \"AccountInfoVehiclesAndTrailers\",\n  components: {\n    AccountInfoVehiclesAndTrailersItem: () =>\n      import(/* webpackChunkName: \"AccountInfoVehiclesAndTrailersItem\" */\n      \"./AccountInfoVehiclesAndTrailersItem.vue\"),\n    modelLogin: ModalLogin\n  },\n\n  props: {\n    prevForm: {\n      type: String,\n      required: true\n    },\n    nextForm: {\n      type: String,\n      required: true\n    },\n    progress: {\n      type: Number,\n      required: true\n    }\n  },\n  data() {\n    return {\n      showmodel: false,\n      save:true,\n      vehiclesTrailers: [],\n      loading: false,\n      error: null,\n      vehicleOrTrailer:'',\n      formErrors:[],\n      type:[\n        'Vehicle',\n        'Trailer'\n      ]\n    };\n  },\n mounted(){\n    if(localStorage.getItem(\"token\")){\n     this.save = false\n   }else{\n     this.$store.dispatch('loadData',localStorage.getItem(\"uuid\"))\n     let a = this.$store.state.getData.data\n    //  let b = JSON.parse(a.val)\n    console.log(\"ba\",a)\n     this.save = true\n   }\n },\n computed:{\n...mapState([\n    'data'\n  ])\n} ,\n   updated(){\nif(localStorage.getItem(\"showModal\") == \"true\")\n     {\n       this.showmodel = true;\n     }\n     else{\n       this.showmodel = false;\n     }\n },\n  created() {\n    this.$emit(\"update-progress\", this.progress);\n    // this.loadCompany();\n  },\n  methods: {\n    addForm() {\n      this.vehiclesTrailers.push({ _uuid: uuidv4() });\n      this.error = null;\n    },\n    removeForm(index) {\n      this.vehiclesTrailers.splice(index, 1);\n\n      if (!this.vehiclesTrailers.length) {\n        this.error = \"Please add at least one vehicle / trailer\";\n      }\n      \n    },\n    updateHint(hint) {\n      this.$emit(\"update-hint\", hint);\n    },\n     onFocus(fieldName) {\n      this.$emit('update-hint', this.hints[fieldName]);\n    },\n    onBlur() {\n      this.$emit('update-hint', '');\n    },\n     validateField(fieldName) {\n      validateField(fieldName, this.vehicleOrTrailer, this.rules, this.formErrors);\n    },\n    validateForm() {\n      this.formErrors = {};\n      return validateForm(this.vehicleOrTrailer, this.rules, this.formErrors);\n    },\n    goPrevForm() {\n      this.$emit(\"go-to-form\", this.prevForm);\n    },\n    goNextForm() {\n      this.$emit(\"go-to-form\", this.nextForm);\n    },\n    async show() {\n      this.setDataFromForms();\n\n      let vehicleForms = this.$refs.vehicleForm;\n      if (!vehicleForms.length) {\n        return;\n      }\n\n      let allFormAreValid = vehicleForms.every(formRef =>\n        formRef.validateForm()\n      );\n      if (!allFormAreValid) {\n        return;\n      }\n\n      this.loading = true;\n      this.error = null;\n\n       try {\n        let data = await API.post(\"company/save\", {\n          key: \"vehiclesTrailers\",\n          val: this.vehiclesTrailers.map(v => {\n            let vehicle = { ...v };\n            delete vehicle._uuid;\n            return vehicle;\n          }),\n            userId:localStorage.getItem(\"userId\"),\n          uuid:localStorage.getItem(\"uuid\")\n        });\n\n        if (data.status === \"OK\") {\n           if (this.showmodel) {\n            this.showmodel = false;\n          } else {\n            this.showmodel = true;\n          }\n        } else if (data.status === \"ERROR\") {\n          this.error = data.messages[0] || data.data;\n        }\n      } catch (err) {\n        console.error(err);\n        this.error = err.message;\n      } finally {\n        this.loading = false;\n      }\n    \n    },\n    async loadCompany() {\n      this.loading = true;\n      this.error = null;\n\n      try {\n        let data = await API.get(\"company/current\");\n\n        if (data.status === \"OK\") {\n          let { vehiclesTrailers } = data.data;\n\n          if (vehiclesTrailers) {\n            // console.log(\"vehiclesTrailers\", uuidv4());\n            console.log(\"vehiclesTrailers\", vehiclesTrailers);\n            this.vehiclesTrailers = vehiclesTrailers.map(v => ({...v,_uuid: uuidv4()}));\n          }else{\n                        this.addForm();\n\n          }\n        } else if (data.status === \"ERROR\") {\n          // this.$router.replace({ name: 'Home' });\n        }\n      } catch (err) {\n        console.error(err);\n        this.error = err.message;\n      } finally {\n        this.loading = false;\n      }\n    },\n    setDataFromForms() {\n      let vehiclesTrailers = [];\n\n      this.$refs.vehicleForm.forEach(formRef => {\n        let formData = formRef.getFormData();\n        vehiclesTrailers.push(formData);\n      });\n\n      this.vehiclesTrailers = vehiclesTrailers;\n    },\n    async updateCompany() {\n      this.setDataFromForms();\n\n      let vehicleForms = this.$refs.vehicleForm;\n      if (!vehicleForms.length) {\n        return;\n      }\n\n      let allFormAreValid = vehicleForms.every(formRef =>\n        formRef.validateForm()\n      );\n      if (!allFormAreValid) {\n        return;\n      }\n\n      this.loading = true;\n      this.error = null;\n\n      try {\n        let data = await API.post(\"company/save\", {\n          key: \"vehiclesTrailers\",\n          val: this.vehiclesTrailers.map(v => {\n            let vehicle = { ...v };\n            delete vehicle._uuid;\n            return vehicle;\n          }),\n          userId:localStorage.getItem(\"userId\"),\n          uuid:localStorage.getItem(\"uuid\")\n        });\n\n        if (data.status === \"OK\") {\n          this.goNextForm();\n        } else if (data.status === \"ERROR\") {\n          this.error = data.messages[0] || data.data;\n        }\n      } catch (err) {\n        console.error(err);\n        this.error = err.message;\n      } finally {\n        this.loading = false;\n      }\n    }\n  }\n};\n",null]}